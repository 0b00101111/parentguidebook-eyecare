---
import { getCollection, getEntry } from 'astro:content';
import type { Lang } from '../../../../i18n/ui';
import ArticleLayout from '../../../../layouts/ArticleLayout.astro';
import { getArticleRouteSegment } from '../../../../utils/routes';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  return articles.map((entry) => ({
    params: {
      lang: entry.data.lang === 'en' ? 'en' : 'zh',
      category: entry.data.category,
      route: getArticleRouteSegment(entry),
    },
    props: { entryId: entry.id.replace(/\.mdx?$/i, '') },
  }));
}

const { lang, category, route } = Astro.params as {
  lang: Lang;
  category: string;
  route: string;
};

const { entryId } = Astro.props as { entryId: string };
const entry = await getEntry('articles', entryId);
if (!entry) throw new Error(`Missing article entry: ${entryId}`);

const canonicalPath = `/${lang}/${category}/${route}/`;
---

<ArticleLayout lang={lang} entry={entry} canonicalPath={canonicalPath} />

